<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego del Impostor</title>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; text-align: center; margin: 0; padding: 20px; }
        .pagina { display: none; max-width: 600px; margin: 20px auto; padding: 25px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); }
        .pagina.activa { display: block; }
        h1, h2, h3 { color: #1a2b4a; margin-top: 0; }
        
        button { font-size: 1rem; font-weight: 600; padding: 12px 20px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; background-color: #007bff; color: white; }
        button:hover { opacity: 0.85; }
        
        /* Clases específicas de botones */
        button.btn-secundario { background-color: #6c757d; }
        button.btn-categoria { background-color: #17a2b8; min-width: 150px; }
        button.btn-categoria.random { background-color: #ffc107; color: #333; }
        
        /* Estilos de botones de jugador */
        .btn-jugador { padding: 20px; font-size: 1.1rem; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        .btn-jugador.verde { background-color: #28a745; }
        .btn-jugador.naranja { background-color: #ffc107; color: #333; }
        .btn-jugador.rojo { background-color: #dc3545; }
        
        /* Inputs y Layout */
        input[type="number"], input[type="text"], select { font-size: 1rem; padding: 10px; margin: 5px 0 15px 0; width: calc(100% - 22px); border: 1px solid #ddd; border-radius: 6px; }
        label { font-weight: 600; display: block; margin-top: 10px; text-align: left; }
        #contenedorNombres input { margin-bottom: 5px; }
        #contenedorBotonesJugadores { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin: 20px 0; }
        
        /* Página de Palabra Secreta */
        #paginaPalabra { background-color: #1a2b4a; color: white; }
        #paginaPalabra h2 { color: #f0f2f5; }
        #palabraSecreta { font-size: 2.5rem; font-weight: bold; color: #ffc107; padding: 40px 0; background-color: rgba(255, 255, 255, 0.1); border-radius: 10px; margin: 20px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; }

        /* === CLASE MAGICA PARA BLOQUEO INVISIBLE === */
        /* Cuando esta clase se agrega, nada dentro es clickeable, pero se ve igual */
        .bloqueo-temporal {
            pointer-events: none; 
        }
    </style>
</head>
<body>

    <div id="paginaConfiguracion" class="pagina activa">
        <h1 data-lang-key="configTitle"></h1>
        
        <label for="langSelector" data-lang-key="langSelectLabel">Selector de Idioma:</label>
        <select id="langSelector"></select>

        <label for="numJugadores" data-lang-key="numPlayersLabel"></label>
        <input type="number" id="numJugadores" value="3" min="3" max="20">
        
        <div id="contenedorNombres"></div>
        
        <label for="numImpostores" data-lang-key="numImpostorsLabel"></label>
        <input type="number" id="numImpostores" value="1" min="1" max="19">
        
        <button id="btnConfirmarJugadores" data-lang-key="confirmButton"></button>
    </div>

    <div id="paginaCategorias" class="pagina">
        <h2 data-lang-key="categoryTitle"></h2>
        <div id="contenedorCategorias"></div>
        <hr>
        <button id="btnVolverConfig" class="btn-secundario" data-lang-key="backToConfig"></button>
    </div>

    <div id="paginaJuego" class="pagina">
        <h2 data-lang-key="gameTitle"></h2>
        <h3 id="categoriaActual"></h3>
        <p data-lang-key="gameSubText"></p>
        <div id="contenedorBotonesJugadores"></div>
        <hr>
        <button id="btnVolverCategorias" class="btn-secundario" data-lang-key="backToCategories"></button>
    </div>

    <div id="paginaPalabra" class="pagina">
        <h2 id="nombreJugadorPalabra"></h2>
        <div id="palabraSecreta"></div>
        <button id="btnOcultarPalabra" data-lang-key="hideButton"></button>
    </div>


    <script>
        // ======================================================
        // CONFIGURACIÓN DE IDIOMAS
        // ======================================================
        const AVAILABLE_LANGUAGES = [
            { file: 'spanish.js', name: 'Español' },
            { file: 'english.js', name: 'English' }
        ];

        // ======================================================
        // VARIABLES GLOBALES
        // ======================================================
        let LANG_DATA = {};
        let jugadores = [];
        let numImpostores = 1;
        let palabraJuegoActual = '';
        let indicesImpostores = [];
        let lastScrollPosition = 0;
        let timerInterval = null;

        // ======================================================
        // SELECTORES DEL DOM
        // ======================================================
        const paginas = document.querySelectorAll('.pagina');
        const langSelector = document.getElementById('langSelector');
        
        const numJugadoresInput = document.getElementById('numJugadores');
        const numImpostoresInput = document.getElementById('numImpostores');
        const contenedorNombres = document.getElementById('contenedorNombres');
        const btnConfirmarJugadores = document.getElementById('btnConfirmarJugadores');

        const contenedorCategorias = document.getElementById('contenedorCategorias');
        const btnVolverConfig = document.getElementById('btnVolverConfig');

        const paginaJuego = document.getElementById('paginaJuego'); // Selector para la página entera
        const categoriaActualElem = document.getElementById('categoriaActual');
        const contenedorBotonesJugadores = document.getElementById('contenedorBotonesJugadores');
        const btnVolverCategorias = document.getElementById('btnVolverCategorias');

        const nombreJugadorPalabraElem = document.getElementById('nombreJugadorPalabra');
        const palabraSecretaElem = document.getElementById('palabraSecreta');
        const btnOcultarPalabra = document.getElementById('btnOcultarPalabra');
        
        numJugadoresInput.addEventListener('focus', function() { this.value = ''; });
        numImpostoresInput.addEventListener('focus', function() { this.value = ''; });

        // ======================================================
        // LÓGICA DE IDIOMA Y CARGA INICIAL
        // ======================================================
        function poblarSelectorIdiomas() {
            langSelector.innerHTML = '';
            AVAILABLE_LANGUAGES.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.file;
                option.textContent = lang.name;
                langSelector.appendChild(option);
            });
        }
        function cargarIdioma(archivoIdioma) {
            const scriptViejo = document.getElementById('lang-script');
            if (scriptViejo) { scriptViejo.remove(); }
            const script = document.createElement('script');
            script.src = archivoIdioma;
            script.id = 'lang-script';
            script.onload = () => {
                LANG_DATA = window.DATA;
                actualizarTextosUI();
                generarCamposNombres();
            };
            document.head.appendChild(script);
        }
        function actualizarTextosUI() {
            document.querySelectorAll('[data-lang-key]').forEach(elem => {
                const key = elem.dataset.langKey;
                if (LANG_DATA.ui[key]) { elem.textContent = LANG_DATA.ui[key]; }
            });
        }
        langSelector.addEventListener('change', (e) => { cargarIdioma(e.target.value); });

        // ======================================================
        // NAVEGACIÓN
        // ======================================================
        function mostrarPagina(idPagina) {
            paginas.forEach(pagina => { pagina.classList.remove('activa'); });
            document.getElementById(idPagina).classList.add('activa');
        }

        // ======================================================
        // PÁGINA 1: CONFIGURACIÓN
        // ======================================================
        function obtenerNombresActuales() {
            const inputs = contenedorNombres.querySelectorAll('input[type="text"]');
            const nombres = [];
            inputs.forEach(input => { nombres.push(input.value); });
            return nombres;
        }
        function generarCamposNombres() {
            const nombresGuardados = obtenerNombresActuales();
            const num = parseInt(numJugadoresInput.value, 10) || 3;
            contenedorNombres.innerHTML = '';
            numImpostoresInput.max = num - 1; 
            for (let i = 0; i < num; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `${LANG_DATA.ui.playerPlaceholder || 'Jugador'} ${i + 1}`;
                input.dataset.index = i;
                if (nombresGuardados[i] !== undefined) input.value = nombresGuardados[i];
                contenedorNombres.appendChild(input);
            }
        }
        btnConfirmarJugadores.addEventListener('click', () => {
            let numJ = parseInt(numJugadoresInput.value, 10);
            let numI = parseInt(numImpostoresInput.value, 10);
            if (isNaN(numJ) || numJ < 3) { alert(LANG_DATA.ui.minPlayersAlert); numJugadoresInput.value = 3; generarCamposNombres(); return; }
            if (isNaN(numI) || numI < 1) { alert(LANG_DATA.ui.impostorMinAlert); numImpostoresInput.value = 1; return; }
            if (numI >= numJ) { alert(LANG_DATA.ui.impostorAlert); numImpostoresInput.value = 1; return; }

            numImpostores = numI;
            jugadores = [];
            const nombresFinales = obtenerNombresActuales(); 
            const inputsPlaceholders = contenedorNombres.querySelectorAll('input[type="text"]');
            nombresFinales.forEach((nombre, index) => {
                const nombreLimpio = nombre.trim() || inputsPlaceholders[index].placeholder;
                jugadores.push({ nombre: nombreLimpio, palabra: '', vistas: 0 });
            });
            cargarPaginaCategorias();
            mostrarPagina('paginaCategorias');
        });
        numJugadoresInput.addEventListener('change', generarCamposNombres);

        // ======================================================
        // PÁGINA 2: CATEGORÍAS
        // ======================================================
        function cargarPaginaCategorias() {
            contenedorCategorias.innerHTML = '';
            const btnAzar = document.createElement('button');
            btnAzar.textContent = LANG_DATA.ui.randomCategory;
            btnAzar.className = 'btn-categoria random';
            btnAzar.onclick = () => {
                const keys = Object.keys(LANG_DATA.categories);
                const catAzar = keys[Math.floor(Math.random() * keys.length)];
                prepararJuego(catAzar);
            };
            contenedorCategorias.appendChild(btnAzar);
            for (const categoria in LANG_DATA.categories) {
                const btn = document.createElement('button');
                btn.textContent = categoria;
                btn.className = 'btn-categoria';
                btn.onclick = () => prepararJuego(categoria);
                contenedorCategorias.appendChild(btn);
            }
        }
        btnVolverConfig.addEventListener('click', () => { mostrarPagina('paginaConfiguracion'); });

        // ======================================================
        // PÁGINA 3: JUEGO
        // ======================================================
        function prepararJuego(categoria) {
            const listaPalabras = LANG_DATA.categories[categoria];
            palabraJuegoActual = listaPalabras[Math.floor(Math.random() * listaPalabras.length)];
            indicesImpostores = [];
            let indicesDisponibles = Array.from({ length: jugadores.length }, (_, i) => i);
            for (let i = 0; i < numImpostores; i++) {
                const randomIndex = Math.floor(Math.random() * indicesDisponibles.length);
                const impostorIndex = indicesDisponibles.splice(randomIndex, 1)[0];
                indicesImpostores.push(impostorIndex);
            }
            jugadores.forEach((jugador, index) => {
                jugador.vistas = 0;
                if (indicesImpostores.includes(index)) {
                    jugador.palabra = LANG_DATA.ui.impostorText;
                } else {
                    jugador.palabra = palabraJuegoActual;
                }
            });
            categoriaActualElem.textContent = `${LANG_DATA.ui.categoryLabel}: ${categoria}`;
            dibujarBotonesJugadores();
            mostrarPagina('paginaJuego');
        }
        function dibujarBotonesJugadores() {
            contenedorBotonesJugadores.innerHTML = '';
            jugadores.forEach((jugador, index) => {
                const btn = document.createElement('button');
                btn.textContent = jugador.nombre;
                btn.dataset.index = index;
                let claseColor = 'verde';
                if (jugador.vistas === 1) claseColor = 'naranja';
                else if (jugador.vistas >= 2) claseColor = 'rojo';
                btn.className = `btn-jugador ${claseColor}`;
                btn.onclick = () => mostrarPalabra(index);
                contenedorBotonesJugadores.appendChild(btn);
            });
        }
        btnVolverCategorias.addEventListener('click', () => { mostrarPagina('paginaCategorias'); });

        // ======================================================
        // PÁGINA 4: REVELAR (CON LÓGICA DE BLOQUEO INVISIBLE)
        // ======================================================
        function mostrarPalabra(index) {
            lastScrollPosition = window.scrollY;
            const jugador = jugadores[index];
            jugador.vistas++;
            nombreJugadorPalabraElem.textContent = `${jugador.nombre}, ${LANG_DATA.ui.wordTitle}`;
            palabraSecretaElem.textContent = jugador.palabra;
            
            mostrarPagina('paginaPalabra');

            // Reset del Timer
            if (timerInterval) clearInterval(timerInterval);
            let tiempoRestante = 5;
            const textoOriginalBoton = LANG_DATA.ui.hideButton || "Ocultar";
            
            btnOcultarPalabra.textContent = `${textoOriginalBoton} (${tiempoRestante})`;

            timerInterval = setInterval(() => {
                tiempoRestante--;
                btnOcultarPalabra.textContent = `${textoOriginalBoton} (${tiempoRestante})`;

                if (tiempoRestante <= 0) {
                    clearInterval(timerInterval);
                    cerrarPantallaPalabra();
                }
            }, 1000);
        }

        function cerrarPantallaPalabra() {
            if (timerInterval) clearInterval(timerInterval);
            
            mostrarPagina('paginaJuego');
            dibujarBotonesJugadores();
            
            requestAnimationFrame(() => {
                window.scrollTo(0, lastScrollPosition);
            });

            // ======================================================
            // BLOQUEO INVISIBLE (POINTER-EVENTS)
            // ======================================================
            // Agregamos una clase al contenedor principal que desactiva los clics
            paginaJuego.classList.add('bloqueo-temporal');
            
            // Después de 1.2 segundos (un poco más de margen), devolvemos los clics
            // Visualmente NO cambia nada.
            setTimeout(() => {
                paginaJuego.classList.remove('bloqueo-temporal');
            }, 500);
        }

        btnOcultarPalabra.addEventListener('click', cerrarPantallaPalabra);

        // ======================================================
        // INICIO
        // ======================================================
        document.addEventListener('DOMContentLoaded', () => {
            poblarSelectorIdiomas();
            cargarIdioma(langSelector.value);
        });

    </script>
</body>
</html>
